# Porensics 1
Description:
```markdown
I'm a huge fan of combining CTF categories into a single challenge. Yet, to this day, there's one mashup I've never seen: 

Pwn + .....forensics??

We had the `porensics1` binary running on one of our security-critical servers that attackers somehow got access to. We're not exactly sure how they got on, but we think it was through this service. Luckily, we keep copies of our network traffic for situations just like this. Can you figure out how they got in and what they did? They left no trace on the host.

This is the kind of stuff that IRL defenders have to do when they've been compromised by a zero day.

[porensics1.pcapng] [porensics1]
```

## Writeup
They are given the PCAP and ELF files. Between analyzing the traffic and searching for the bugs in the ELF, they should be able to discover the shellcode that is ran after leaking the stack address/exploiting the buffer overflow/etc. Outside of XORing the flag with a hard-coded 4-byte key, no attempt was made to obfuscate the network traffic.

A format string vulnerability is used to leak a stack pointer. The overflow is exploited and the return address is overwritten with the address for the shellcode. The shellcode runs `popen('cat fl*','r')` (which returns a FILE* object), then `fgets_unlocked($rsp, 0x30, the_file_object)` (to write the flag onto the stack), then XORs it with the key 0x509d7c94, and ends with writing the XORed flag to the client file descriptor. The binary was statically-compiled with no protections.

The working exploit and shellcode can be found in `exploit.py`.

**Flag** - `HC{it_w4s_kind4_fun_m4king_these_exploits}`