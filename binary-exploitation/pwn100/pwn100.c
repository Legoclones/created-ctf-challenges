#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

__attribute__((constructor)) void flush_buf() {
    setbuf(stdin, NULL);
    setbuf(stdout, NULL);
    setbuf(stderr, NULL);
}

int main(int argc, char* argv[]) {
    puts("Welcome to the leak challenge!");
    printf("The current memory address of puts() is %p\n", puts);
    puts("What's the current memory address of system()? Provide your answer like 0x12345678");
    printf("> ");

    void * buf;
    scanf("%p", &buf);

    if (buf == (void *)system) {
        puts("Congrats! Here is your flag:");
        system("cat flag.txt");
    } else {
        puts("Sorry, that's not the correct address of system().");
    }
    return 0;
}